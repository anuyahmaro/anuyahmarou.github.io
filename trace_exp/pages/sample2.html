<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Trace</title>
    <!--<link rel="stylesheet" type="text/css" href="../static/css/materialize.css" />-->
    <!--<link rel="stylesheet" type="text/css" href="../static/css/style3.css" />-->
    <!--<link rel="stylesheet" type="text/css" href="../static/css/myStyles.css" />-->

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <!--<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css" />-->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>
    <link href="http://netdna.bootstrapcdn.com/bootstrap/3.0.0/css/bootstrap.min.css" rel="stylesheet"/>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
    <script src="http://netdna.bootstrapcdn.com/bootstrap/3.0.0/js/bootstrap.min.js"></script>
    <!--<link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">-->
    <!--<link rel="stylesheet" type="text/css" href="../static/css/style3.css" />-->
    <link rel="stylesheet" type="text/css" href="../static/css/myStyles2.css" />
    <link rel="stylesheet" type="text/css" href="../static/css/materialize_select.css" />

</head>
<body class = 'blue-grey lighten-5' >

<div class="row">
    <div class = "artifact-panels col s12">

        <div class="col s5" style="overflow: scroll" >


            <div>
                <table id="something"></table>
                <div class="next_prev_target" style="text-align: center; background-color: white; padding: 5px">
                    <button class="waves-effect waves-light btn btn-small prev_start" value="0" onclick="return changePrev()" ><i class="material-icons left">navigate_before</i>Prev</button>
                    <button class="waves-effect waves-light btn btn-small next_end" value="4" onclick="return changeNext()">Next<i class="material-icons right">navigate_next</i></button>
                </div>
            </div>

            <br>
            <br>

            <!--<div>-->
                <!--<table id="something2"></table>-->
                <!--<div class="next_prev_target" style="text-align: center; background-color: white; padding: 5px">-->
                    <!--<button class="waves-effect waves-light btn btn-small prev_start" value="0" onclick="updateTargetData(); " ><i class="material-icons left">navigate_before</i>Prev</button>-->
                    <!--<button class="waves-effect waves-light btn btn-small next_end" value="4" onclick="updateTargetData(); "><i class="material-icons right">navigate_next</i>Next</button>-->
                <!--</div>-->
            <!--</div>-->

            <!--<form id="radio_btn_select">-->
            <!--<div style="display:inline-block; padding:20px;" >-->

            <!--<input type = "radio"-->
            <!--name = "radSize"-->
            <!--id = "sizeSmall"-->
            <!--value = "small"-->
            <!--checked = "checked" />-->
            <!--<label for = "sizeSmall">Small</label>-->

            <!--<input type = "radio"-->
            <!--name = "radSize"-->
            <!--id = "sizeMed"-->
            <!--value = "medium" />-->
            <!--<label for = "sizeMed">Medium</label>-->

            <!--<input type = "radio"-->
            <!--name = "radSize"-->
            <!--id = "sizeLarge"-->
            <!--value = "large" />-->
            <!--<label for = "sizeLarge">Large</label>-->
            <!--</div>-->
            <!--</form>-->



            <!--<div  style='font-size: 0.9em; display:inline-block; padding:20px;'>-->
            <!--<label>-->
            <!--<input name='group1' type='radio'/>-->
            <!--<span style='color: black'>Link</span>-->
            <!--</label>-->
            <!--<label>-->
            <!--<input name='group1' type='radio' />-->
            <!--<span style='color: black'>No link</span>-->
            <!--</label>-->
            <!--<label>-->
            <!--<input name='group1' type='radio'/>-->
            <!--<span style='color: black'>Unvetted</span>-->
            <!--</label>-->
            <!--</div>-->


            <div>
                <div class="modal fade  come-from-modal right" id="myModal1" tabindex="-1" role="dialog" aria-labelledby="myModal1_label">
                    <div class="modal-dialog" role="document">
                        <div class="modal-content" >
                            <div class="modal-header">
                                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                                <h4 class="modal-title" id="myModal1_label">Modal title</h4>
                            </div>
                            <div class="modal-body" style="overflow: scroll; height: 200px">
                                <h5 style="text-align: center">Vetting Details</h5>
                                <table>
                                    <tr>
                                        <th>Date</th>
                                        <th>Name</th>
                                        <th>Role</th>
                                        <th>Link correct?</th>
                                    </tr>
                                    <tr>
                                        <td>11/06/19</td>
                                        <td>J Cleland-Huang</td>
                                        <td>Software Engr</td>
                                        <td>Yes</td>
                                    </tr>
                                    <tr>
                                        <td>12/06/19</td>
                                        <td>Y Liu</td>
                                        <td>Safety Analyst</td>
                                        <td>No</td>
                                    </tr>


                                </table>

                            </div>

                        </div>
                    </div>
                </div>

                <div class="modal fade  come-from-modal right" id="myModal2" tabindex="-1" role="dialog" aria-labelledby="myModal2_label">
                    <div class="modal-dialog" role="document">
                        <div class="modal-content" >
                            <div class="modal-header">
                                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                                <h4 class="modal-title" id="myModal2_label">Modal title</h4>
                            </div>
                            <div class="modal-body" style="overflow: scroll; height: 200px">
                                <h5 style="text-align: center">Vetting Details</h5>
                                <table>
                                    <tr>
                                        <th>Date</th>
                                        <th>Name</th>
                                        <th>Role</th>
                                        <th>Link correct?</th>
                                    </tr>
                                    <tr>
                                        <td>01/02/20</td>
                                        <td>N Farrell</td>
                                        <td>Researcher</td>
                                        <td>No</td>
                                    </tr>
                                    <tr>
                                        <td>01/10/20</td>
                                        <td>G Rovelli</td>
                                        <td>Software Engr</td>
                                        <td>Yes</td>
                                    </tr>
                                </table>
                            </div>

                        </div>
                    </div>
                </div>

                <div class="modal fade  come-from-modal right" id="myModal3" tabindex="-1" role="dialog" aria-labelledby="myModal3_label">
                    <div class="modal-dialog" role="document">
                        <div class="modal-content" >
                            <div class="modal-header">
                                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                                <h4 class="modal-title" id="myModal3_label" style="color: black; text-align: center">Vetting Details</h4>
                            </div>
                            <div class="modal-body" style="overflow: scroll; height: 200px">

                                <table>
                                    <tr>
                                        <th>Date</th>
                                        <th>Name</th>
                                        <th>Role</th>
                                        <th>Link correct?</th>
                                    </tr>
                                    <tr>
                                        <td>11/06/19</td>
                                        <td>J Cleland-Huang</td>
                                        <td>Software Engr</td>
                                        <td>Yes</td>
                                    </tr>
                                    <tr>
                                        <td>12/06/19</td>
                                        <td>Y Liu</td>
                                        <td>Safety Analyst</td>
                                        <td>No</td>
                                    </tr>
                                    <tr>
                                        <td>12/20/19</td>
                                        <td>J Lin</td>
                                        <td>Developer</td>
                                        <td>Yes</td>
                                    </tr>
                                    <tr>
                                        <td>12/24/19</td>
                                        <td>R Metoyer</td>
                                        <td>Designer</td>
                                        <td>Yes</td>
                                    </tr>
                                    <tr>
                                        <td>01/02/20</td>
                                        <td>N Farrell</td>
                                        <td>Researcher</td>
                                        <td>No</td>
                                    </tr>
                                    <tr>
                                        <td>01/10/20</td>
                                        <td>G Rovelli</td>
                                        <td>Software Engr</td>
                                        <td>Yes</td>
                                    </tr>
                                </table>

                            </div>

                        </div>
                    </div>
                </div>

                <div class="modal fade  come-from-modal right" id="myModal4" tabindex="-1" role="dialog" aria-labelledby="myModal4_label">
                    <div class="modal-dialog" role="document">
                        <div class="modal-content" >
                            <div class="modal-header">
                                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                                <h4 class="modal-title" id="myModal4_label" style="color: black; text-align: center">Vetting Details</h4>
                            </div>
                            <div class="modal-body" style="overflow: scroll; height: 200px">

                                <table>
                                    <tr>
                                        <th>Date</th>
                                        <th>Name</th>
                                        <th>Role</th>
                                        <th>Link correct?</th>
                                    </tr>
                                    <tr>
                                        <td>11/06/19</td>
                                        <td>J Cleland-Huang</td>
                                        <td>Software Engr</td>
                                        <td>Yes</td>
                                    </tr>
                                    <tr>
                                        <td>01/02/20</td>
                                        <td>N Farrell</td>
                                        <td>Researcher</td>
                                        <td>No</td>
                                    </tr>
                                    <tr>
                                        <td>01/10/20</td>
                                        <td>G Rovelli</td>
                                        <td>Software Engr</td>
                                        <td>Yes</td>
                                    </tr>
                                </table>

                            </div>
                        </div>
                    </div>
                </div>



                <div class="modal fade  come-from-modal right" id="myModal5" tabindex="-1" role="dialog" aria-labelledby="myModal5_label">
                    <div class="modal-dialog" role="document">
                        <div class="modal-content" >
                            <div class="modal-header">
                                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                                <h4 class="modal-title" id="myModal5_label" style="color: black; text-align: center">Vetting Details</h4>
                            </div>
                            <div class="modal-body" style="overflow: scroll; height: 200px">

                                <table>
                                    <tr>
                                        <th>Date</th>
                                        <th>Name</th>
                                        <th>Role</th>
                                        <th>Link correct?</th>
                                    </tr>
                                    <tr>
                                        <td>01/10/20</td>
                                        <td>G Rovelli</td>
                                        <td>Software Engr</td>
                                        <td>Yes</td>
                                    </tr>
                                </table>

                            </div>
                        </div>
                    </div>
                </div>

                <div class="modal fade  come-from-modal right" id="myModal6" tabindex="-1" role="dialog" aria-labelledby="myModal6_label">
                    <div class="modal-dialog" role="document">
                        <div class="modal-content" >
                            <div class="modal-header">
                                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                                <h4 class="modal-title" id="myModal6_label" style="color: black; text-align: center">Vetting Details</h4>
                            </div>
                            <div class="modal-body" style="overflow: scroll; height: 200px">

                                <table>
                                    <tr>
                                        <th>Date</th>
                                        <th>Name</th>
                                        <th>Role</th>
                                        <th>Link correct?</th>
                                    </tr>
                                    <tr>
                                        <td>11/06/19</td>
                                        <td>J Cleland-Huang</td>
                                        <td>Software Engr</td>
                                        <td>Yes</td>
                                    </tr>

                                </table>

                            </div>

                        </div>
                    </div>
                </div>

                <div class="modal fade  come-from-modal right" id="myModal7" tabindex="-1" role="dialog" aria-labelledby="myModal7_label">
                    <div class="modal-dialog" role="document">
                        <div class="modal-content" >
                            <div class="modal-header">
                                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                                <h4 class="modal-title" id="myModal7_label" style="color: black; text-align: center">Vetting Details</h4>
                            </div>
                            <div class="modal-body" style="overflow: scroll; height: 200px">

                                <table>
                                    <tr>
                                        <th>Date</th>
                                        <th>Name</th>
                                        <th>Role</th>
                                        <th>Link correct?</th>
                                    </tr>
                                    <tr>
                                        <td>11/06/19</td>
                                        <td>J Cleland-Huang</td>
                                        <td>Software Engr</td>
                                        <td>Yes</td>
                                    </tr>
                                    <tr>
                                        <td>12/06/19</td>
                                        <td>Y Liu</td>
                                        <td>Safety Analyst</td>
                                        <td>No</td>
                                    </tr>
                                </table>

                            </div>

                        </div>
                    </div>
                </div>

                <div class="modal fade  come-from-modal right" id="myModal8" tabindex="-1" role="dialog" aria-labelledby="myModal8_label">
                    <div class="modal-dialog" role="document">
                        <div class="modal-content" >
                            <div class="modal-header">
                                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                                <h4 class="modal-title" id="myModal8_label" style="color: black; text-align: center">Vetting Details</h4>
                            </div>
                            <div class="modal-body" style="overflow: scroll; height: 200px">

                                <table>
                                    <tr>
                                        <th>Date</th>
                                        <th>Name</th>
                                        <th>Role</th>
                                        <th>Link correct?</th>
                                    </tr>
                                    <tr>
                                        <td>11/06/19</td>
                                        <td>J Cleland-Huang</td>
                                        <td>Software Engr</td>
                                        <td>Yes</td>
                                    </tr>
                                    <tr>
                                        <td>12/06/19</td>
                                        <td>Y Liu</td>
                                        <td>Safety Analyst</td>
                                        <td>No</td>
                                    </tr>
                                    <tr>
                                        <td>12/20/19</td>
                                        <td>J Lin</td>
                                        <td>Developer</td>
                                        <td>Yes</td>
                                    </tr>
                                    <tr>
                                        <td>12/24/19</td>
                                        <td>R Metoyer</td>
                                        <td>Designer</td>
                                        <td>Yes</td>
                                    </tr>
                                    <tr>
                                        <td>01/02/20</td>
                                        <td>N Farrell</td>
                                        <td>Researcher</td>
                                        <td>No</td>
                                    </tr>
                                    <tr>
                                        <td>01/10/20</td>
                                        <td>G Rovelli</td>
                                        <td>Software Engr</td>
                                        <td>Yes</td>
                                    </tr>
                                </table>

                            </div>

                        </div>
                    </div>
                </div>
            </div>






        </div>
        <div class="content-panel col s5"  >
            <!--<ul id="target_artifacts" class="collapsible content-panel-style target_list">-->
            <!--</ul>-->
            <div class="content-panel-style2 target_list" style="margin-top: 8px; margin-left: 0px;">
                <table id="target_artifacts" >
                    <colgroup>
                        <col span="1" style="width: 60%;">
                        <col span="1" style="width: 40%;">
                    </colgroup>
                </table>
                <div class="next_prev_target" style="text-align: center; background-color: white; padding: 5px">
                    <button class="waves-effect waves-light btn btn-small prev_start" value="0" onclick="updateStuff(); " ><i class="material-icons left">navigate_before</i>Prev</button>
                    <button class="waves-effect waves-light btn btn-small next_end" value="4" onclick="updateStuff(); "><i class="material-icons right">navigate_next</i>Next</button>
                </div>
            </div>
        </div>


    </div>
</div>
</body>

<script src="https://unpkg.com/d3@6.6.1/dist/d3.min.js"></script>
<script>

    // document.body.style.overflow = 'hidden';
    document.addEventListener('DOMContentLoaded', function() {
        var elems = document.querySelectorAll('.tooltipped');
        var instances = M.Tooltip.init(elems);
    });

    function ref() {
        location.reload()
    }

    function changePrev(){
        var prev_value = document.getElementsByClassName("prev_start")[0].value;
        var next_value = document.getElementsByClassName("next_end")[0].value;
        var next_res;
        var prev_res;

        if (+prev_value===0){
            next_res = 4;
            prev_res = 0;
            document.getElementsByClassName("prev_start")[0].value = prev_res;
            document.getElementsByClassName("next_end")[0].value = next_res;
            //
           return false;

            // return 0;
        }
        else {
            next_res =  +next_value - 4;
            prev_res =  +prev_value - 4;
            document.getElementsByClassName("prev_start")[0].value = prev_res;
            document.getElementsByClassName("next_end")[0].value = next_res;

            var targetArtifacts = document.getElementsByClassName("eachTarget_artifact");

            var previous_ids = [];

            for (var k = 0;  k < targetArtifacts.length; k++){
                previous_ids.push(targetArtifacts[k].id);

                document.getElementById(targetArtifacts[k].id).remove();
            }


            var targetArtifacts = document.getElementsByClassName("eachTarget_artifact");

            var previous_ids = [];

            for (var k = 0; k < targetArtifacts.length; k++) {
                previous_ids.push(targetArtifacts[k].id);

                // document.getElementById(targetArtifacts[k].id).remove();
            }

            for (var l = 0; l < previous_ids.length; l++) {
                // previous_ids.push(targetArtifacts[k].id);

                document.getElementById(previous_ids[l]).remove();
            }

            updateTargetData2();
            return true;


        }





    }

    function changeNext(){
        console.log("I am clicked")
        var prev_value = document.getElementsByClassName("prev_start")[0].value;
        var next_value = document.getElementsByClassName("next_end")[0].value;

        console.log(prev_value, next_value);


        if (+next_value < 8) {

            var next_res = +next_value + 4;
            var prev_res = +prev_value + 4;
            document.getElementsByClassName("next_end")[0].value = next_res;
            document.getElementsByClassName("prev_start")[0].value = prev_res;


            var targetArtifacts = document.getElementsByClassName("eachTarget_artifact");

            var previous_ids = [];

            for (var k = 0; k < targetArtifacts.length; k++) {
                previous_ids.push(targetArtifacts[k].id);

                // document.getElementById(targetArtifacts[k].id).remove();
            }

            for (var l = 0; l < previous_ids.length; l++) {
                // previous_ids.push(targetArtifacts[k].id);

                document.getElementById(previous_ids[l]).remove();
            }

            console.log(previous_ids);
            updateTargetData2();
                return true
        }
        else {
            return false;
        }





    }



    function updateTargetData2() {

        var prev_start = +document.getElementsByClassName("prev_start")[0].value;
        var next_end = +document.getElementsByClassName("next_end")[0].value;

        console.log(document.getElementsByClassName("prev_start")[0].value, document.getElementsByClassName("next_end")[0].value)
        console.log(document.getElementById('something').rows.length);

        // for (var i =prev_start; i < next_end; i++){
        //     console.log(i)
        // }

        var data_to_use = [];



        // data_to_use.push(all_target_data[4])
        // data_to_use.push(all_target_data[5])
        // data_to_use.push(all_target_data[6])

        for(var i = prev_start; i < next_end; i++){
            data_to_use.push((all_target_data[i]))
        }

        console.log("plssss")
        console.log(data_to_use);
        console.log(prev_start);
        console.log(next_end);
        console.log("help mee Jesus")
        // console.log(prev_start, next_end);




        // d3.json("artifact.json").then(data => {
        //     var new_data = data[0].targets;
        //     // console.log(prev_start, next_end);
        //
        //     console.log("This thing just frustrates me___")
        //     console.log(new_data.splice(4, 5));
        //     console.log("This thing just frustrates me")
        //
        //     var artifact_data = {
        //         "info": []
        //     };
        //
        //
        //     new_data.forEach(function (d) {
        //         artifact_data["info"].push({
        //             "aid": d["id"], "content": d["text"],
        //             "score": d["score"]
        //         });
        //
        //     });
        //
        //
        //     // console.log(prev_start, next_end);
        //     var latest_data = artifact_data["info"];
        //
        //     console.log(latest_data);
        //     // // console.log(prev_start-1, next_end-2)
            //
            var outer_list = d3.select("#something")
                .selectAll("tbody");

            outer_list
                .data(data_to_use, function (d) {
                    // console.log("xy", d);
                    return d;
                })
                .enter()
                .append("tbody")
                .attr("class", "eachTarget_artifact")
                // .attr("id", function (d, i) {
                //     return "targetArt_"+(i+1);
                // });
                .attr("id", function (d, i) {
                    return "targetArt_"+(1+i);
                }).append("tr")
                .attr("id", function (d, i) {
                    return "row" + (i + 1);
                })
                .attr("class", "collapsible_");


        var collapsible_data = d3.selectAll(".collapsible_")
            .style("background-color", "white");

        var details_div = collapsible_data
                    .append("td");

        details_div.append("div")
        .append("div")
                .attr("class", "action_btn")
                .style("margin-top", "12px")
                .style("margin-bottom", "12px");

        var outer_list_row = d3.selectAll(".action_btn");

        outer_list_row.append("a")
                .attr("class", "targ_art_name waves-effect waves-light blue-grey lighten-3 dim-grey-text btn-small artifact-type collapsible_new")
                // .attr("href", "https://anuyahmaro.github.io")
                // .attr("target", "_blank")
                // .style("background-color", "#7F00FF")
                .attr("id", function (d, i) {
                    return "row" + (i + 1) + "_target_button"
                })
                .style("color", "black")
                .style("margin-left", "20px")
                .text(function (d) {
                    return "Target " + d.aid;
                });

        outer_list_row.append("button")
                .attr("type", "button")
                .attr("class", "btn btn-small score_btn")
                .style("background-color", "white")
                .style("cursor", "unset")
                .style("box-shadow", "none")
                .style("color", "black")
                .style("margin-left", "2px")
                .html(function (d) {
                    return "<b>Score: </b>" + d.score
                });
            //
        outer_list_row.append("button")
                .attr("type", "button")
                .attr("class", "btn btn-small tooltipped vetting-det modal-trigger vetting_btn")
                .style("box-shadow", "none")
                .attr("id", function (d, i) {
                    return "modal" + (i + 1) + "_fire"
                })
                .attr("href", function (d, i) {
                    return "#modal" + (i + 1)
                })
                .style("background-color", "white")
                .attr("data-position", "bottom")
                .style("margin-left", "2px")
                .style("color", "black")
                .attr("data-tooltip", "I am a tooltip")
                .html(function (d) {
                    return "5 <i class='material-icons' style='font-size: 1em'>thumb_up</i> 2 <i class='material-icons' style='font-size: 1em'>thumb_down</i>"
                });
            //
            details_div.append("p")
                .attr("class", "art_summary")
                .style("display", "block")
                .style("font-size", "0.9em")
                .style("padding", "10px")
                .style("margin-left", "20px")
                .text(function (d) {
                    return d.content.slice(0, 400).replaceAll("_", " ") + "...";
                });
            //
            //
            collapsible_data.append("td")
                .html(function (d, i) {
                    return "<div id='row"+(i+1)+"_vote' style='font-size: 0.8em; display:inline-block; padding:7px;'>\n" +
                        "         <label>\n" +
                        "         <input name='group"+(i+1)+"' type='radio' checked/>\n" +
                        "         <span style='color: black'>Link</span>\n" +
                        "         </label>\n" +
                        "         <label>\n" +
                        "             <input name='group"+(i+1)+"' type='radio'  />\n" +
                        "             <span style='color: black'>No link</span>\n" +
                        "         </label>\n" +
                        "         <label>\n" +
                        "             <input  name='group"+(i+1)+"' type='radio'/>\n" +
                        "             <span style='color: black'>Unvetted</span>\n" +
                        "         </label>\n" +
                        "         </div>"
                });
            //
            //

        var collapsed_content = d3.selectAll(".eachTarget_artifact")
           .append("tr")
            .attr("class", "collapse-content")
                .attr("id", function (d, i) {
                    return "row" + (i + 1) + "_content";
                })
                .style("background-color", "white");
            //
            collapsed_content.append("td")
            //
            // .attr("colspan", "2")
                .append("div")
                .attr("id", function (d, i) {
                    return "row" + (i + 1) + "_content_data";
                })
                .attr("class", "collapsed_content_data")
                .style("display", "none")
                .style("padding", "10px")
                .style("background-color", "#eceff1")
                .text(function (d) {
                    return d.content
                });
            //
        collapsed_content.append("td");


    }


    var all_target_data = [];


    function drawTargets(data) {

        var target_data = data[0].targets;
        // console.log(target_data);
        // console.log(document.getElementsByClassName("prev_start")[0].value);


        var artifact_data = {
            "info": []
        };

        target_data.forEach(function (d) {
            artifact_data["info"].push({"aid": d["id"], "content": d["text"],
                "score": d["score"]});

           all_target_data.push({"aid": d["id"], "content": d["text"],
               "score": d["score"]})
        });


        var outer_list = d3.select("#something")
            .selectAll("tbody")
            .data(artifact_data['info'].splice(0, 4))
            .enter()
            .append("tbody")
            // .attr("class", "eachTarget_artifact")
            .attr("class", "eachTarget_artifact")
            .attr("id", function (d, i) {
                return "targetArt_"+(i+1);
            });


        var table_rows = outer_list.append("tr")
            .attr("id", function (d, i) {
                return "row" + (i + 1);
            })
            .attr("class", "collapsible_")
            .style("background-color", "white");

        var table_row_summary = table_rows.append("td");

        var table_row_summary_header_buttons = table_row_summary.append("div");


        var table_row_summary_header_buttons_outerdiv = table_row_summary_header_buttons.append("div")
            .attr("class", "action_btn")
            .style("margin-top", "12px")
            .style("margin-bottom", "12px");

        table_row_summary_header_buttons_outerdiv.append("a")
            .attr("class", "targ_art_name waves-effect waves-light blue-grey lighten-3 dim-grey-text btn-small artifact-type collapsible_new")
            .attr("id", function (d, i) {
                return "row" + (i + 1) + "_target_button"
            })
            .style("color", "black")
            .style("margin-left", "20px")
            .text(function (d) {
                return "Target " + d.aid;
            });

        table_row_summary_header_buttons_outerdiv.append("button")
            .attr("type", "button")
            .attr("class", "btn btn-small score_btn")
            .style("background-color", "white")
            .style("cursor", "unset")
            .style("box-shadow", "none")
            .style("color", "black")
            .style("margin-left", "2px")
            .html(function (d) {
                return "<b>Score: </b>" + d.score
            });

        table_row_summary_header_buttons_outerdiv.append("button")
            .attr("type", "button")
            .attr("class", "btn btn-small tooltipped vetting-det modal-trigger vetting_btn")
            .style("box-shadow", "none")
            .attr("id", function (d, i) {
                return "modal" + (i + 1) + "_fire"
            })
            .attr("href", function (d, i) {
                return "#modal" + (i + 1)
            })
            .style("background-color", "white")
            .attr("data-position", "bottom")
            .style("margin-left", "2px")
            .style("color", "black")
            .attr("data-tooltip", "I am a tooltip")
            .html(function (d) {
                return "5 <i class='material-icons' style='font-size: 1em'>thumb_up</i> 2 <i class='material-icons' style='font-size: 1em'>thumb_down</i>"
            });

        table_row_summary_header_buttons.append("p")
            .attr("class", "art_summary")
            .style("display", "block")
            .style("font-size", "0.9em")
            .style("padding", "10px")
            .style("margin-left", "20px")
            .text(function (d) {
                return d.content.slice(0, 400).replaceAll("_", " ") + "...";
            });


        table_rows.append("td")
            .html(function (d, i) {
                return "<div id='row"+(i+1)+"_vote' style='font-size: 0.8em; display:inline-block; padding:7px;'>\n" +
                    "         <label>\n" +
                    "         <input name='group"+(i+1)+"' type='radio' checked/>\n" +
                    "         <span style='color: black'>Link</span>\n" +
                    "         </label>\n" +
                    "         <label>\n" +
                    "             <input name='group"+(i+1)+"' type='radio'  />\n" +
                    "             <span style='color: black'>No link</span>\n" +
                    "         </label>\n" +
                    "         <label>\n" +
                    "             <input  name='group"+(i+1)+"' type='radio'/>\n" +
                    "             <span style='color: black'>Unvetted</span>\n" +
                    "         </label>\n" +
                    "         </div>"
            });


        var table_rows_content = outer_list.append("tr")
            .attr("class", "collapse-content")
            .attr("id", function (d, i) {
                return "row" + (i + 1) + "_content";
            })
            .style("background-color", "white");

        table_rows_content.append("td")

        // .attr("colspan", "2")
            .append("div")
            .attr("id", function (d, i) {
                return "row" + (i + 1) + "_content_data";
            })
            .attr("class", "collapsed_content_data")
            .style("display", "none")
            .style("padding", "10px")
            .style("background-color", "#eceff1")
            .text(function (d) {
                return d.content
            });

        table_rows_content.append("td");


        // var rows = d3.select("#something")
        //     .selectAll("tbody")
        //     .data(artifact_data['info'], function (d) {
        //         return d;
        //     })
        //     .enter()
        //     .append("tbody")
        //     .attr("class", "eachTarget_artifact");
        //
        // rows
        //     .append("tr")
        //     .append("td")
        //     .text(function(d) {return d.content; });




        // Loading the target data has finished!
        var coll_ = document.getElementsByClassName("collapsible-header");
        var timesClicked = 0;
        for (i = 0; i < coll_.length; i++) {
            coll_[i].addEventListener("click", collapseFunc);

            // coll_[i].addEventListener("click", d);
        }



        var coll_new = document.getElementsByClassName("collapsible_new");

        for (var i = 0; i < coll_new.length; i++) {
            coll_new[i].addEventListener("click", fnb);
        }

        var back_btn = document.getElementsByClassName("back_button");
        for (var i = 0; i < back_btn.length; i++) {
            back_btn[i].addEventListener("click", ref);
        }



        function fnb() {
            timesClicked++;

            if (timesClicked > 1) {
                ref()
            }
            else{

                // console.log(this.id);
                var target_this_id = this.id.split("_")[0];
                console.log(target_this_id);

                var target_this = document.getElementById(target_this_id);
                // var main_parent =


                target_this.classList.toggle("active");
                //
                var index_of_current_target;

                // console.log(document.getElementById(this.nextElementSibling.id + "_data").style.display);

                for (var q = 0; q < coll_new.length; q++) {
                    var current_q_id = coll_new[q].id.split("_")[0];
                    var current_q = document.getElementById(current_q_id);
                    if (current_q === target_this) {
                        index_of_current_target = q;

                        console.log(index_of_current_target);


                        var content = target_this.nextElementSibling;

                        console.log(content);

                        var content_data = document.getElementById(content.id + "_data");
                        console.log(content_data.style.display);
                        //
                        //
                        current_q.setAttribute("id", "currently_clicked_target");
                        // content_data.setAttribute("id", "currently_clicked_target_content");

                        //
                        if (content_data.style.display === "block") {
                            console.log("It is closed right now");
                            content_data.style.display = "none";

                            //
                            //
                        }
                        else {
                            content_data.style.display = "block";

                            console.log("It is open right now");
                            current_q.getElementsByClassName("art_summary")[0].style.display = "none"
                            // coll_2[q].classList.remove("collapsible_");


                        }
                    }
                    else { // while the collapsibles are not active, make sure to show their summary

                        current_q.classList.remove("active");
                        // coll_2[q].classList.remove("collapsible_");
                        current_q.style.display = "none";
                        current_q.setAttribute("id", "");
                        current_q.nextElementSibling.setAttribute("id", "");
                        current_q.nextElementSibling.style.display = "none";


                    }

                }


            }


        }


    }


    var somethingData = ["Please", "Work", "I beg"];

    function updateSomething(data){
        var rel_data = [];
        data.forEach(d=> {
            rel_data.push(d);
        });

        var rows = d3.select("#something2").selectAll("tr")
            .data(rel_data).enter().append(("tr"));

        rows.append("td")
            .text(function (d, i) {
                return rel_data[i];
            })

    }

    function updateTargetData(){
        console.log("Clicked")
        var new_data = ["I hope", "O pls"];

        var rows = d3.select("#something2").selectAll("tr")
            .data(new_data, function (d) {
                console.log("xy", d);
                return d;
            });

        // console.log(new_data);

        rows.enter()
            .append("tr")
            .append("td")
            .text(function(d) {return d; });

        rows.exit().remove();

    }

    function shuffle(arra1) {
        var ctr = arra1.length, temp, index;

// While there are elements in the array
        while (ctr > 0) {
// Pick a random index
            index = Math.floor(Math.random() * ctr);
// Decrease ctr by 1
            ctr--;
// And swap the last element with it
            temp = arra1[ctr];
            arra1[ctr] = arra1[index];
            arra1[index] = temp;
        }
        return arra1;
    }





    updateSomething(somethingData);



    d3.json("artifact.json").then(data => {


        drawTargets(data);


    });



</script>
</html>